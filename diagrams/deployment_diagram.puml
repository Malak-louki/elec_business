@startuml deployment_diagram

title Diagramme de Déploiement - Elec Business (Production)

skinparam node {
    BackgroundColor LightBlue
    BorderColor DarkBlue
}

skinparam component {
    BackgroundColor LightYellow
    BorderColor DarkGoldenRod
}

' ==============================================
' INTERNET
' ==============================================
cloud "Internet" {
    actor "Navigateur" as Browser
    actor "Email\n(SMTP)" as SMTP
}

' ==============================================
' SERVEUR PRODUCTION
' ==============================================
node "**Serveur Production**\n(Docker Host)" {
    
    frame "Docker Network" {
        
        ' NGINX
        component "**Nginx**\n(Reverse Proxy)" as Nginx {
            artifact "Angular\n(Static)" as Angular
        }
        
        note right of Nginx
          Port 443 (HTTPS)
          TLS/SSL
          
          Routes:
          / → Angular
          /api → Spring Boot
        end note
        
        ' SPRING BOOT
        component "**Spring Boot**\n(API REST)" as SpringBoot {
            artifact "elec-business.jar" as Jar
        }
        
        note right of SpringBoot
          Port interne: 8080
          
          Endpoints:
          /api/auth
          /api/bookings
          /api/payments
          /api/owner/dashboard
        end note
        
        ' MYSQL
        database "**MySQL 8.0**\n(BDD)" as MySQL {
            storage "Volume\nmysql_data" as Volume
        }
        
        note right of MySQL
          Port interne: 3306
          
          Accès sécurisé
          (pas d'exposition publique)
        end note
    }
}

' ==============================================
' CONFIGURATION
' ==============================================
artifact "Variables\nd'environnement" as EnvVars
artifact "Certificats\nTLS" as TLS

note right of EnvVars
  JWT_SECRET
  DB_USER / DB_PASSWORD
  MAIL_USERNAME / MAIL_PASSWORD
  CORS_ORIGINS
end note

note right of TLS
  Let's Encrypt
  Renouvellement automatique
end note

' ==============================================
' FLUX
' ==============================================
Browser --> Nginx : HTTPS :443
Nginx --> SpringBoot : HTTP :8080
SpringBoot --> MySQL : MySQL :3306
SpringBoot --> SMTP : SMTP
EnvVars .> SpringBoot
TLS .> Nginx

' ==============================================
' NOTES TECHNIQUES
' ==============================================
note bottom of SpringBoot
  **Docker Compose**
  restart: unless-stopped
  
  Healthcheck:
  curl /actuator/health
end note

note bottom of MySQL
  **Sauvegarde**
  Volume Docker persistant
  
  Healthcheck:
  mysqladmin ping
end note

@enduml
